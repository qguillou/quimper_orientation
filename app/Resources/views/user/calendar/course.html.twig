{% extends 'base.html.twig' %}

{% block body %}
<!-- On récupére la couleur d'affichage de la course !-->
{% set color = 'black' %}
{% if course.type != null and course.type.color != null and course.type.color != '' %}
{% set color = course.type.color %}
{% endif %}

<div class="col-md-12">
  <h1 style="color:{{color}}; font-weight:bold">{{course.nom}}</h1>
  <p class="lead">
    Retrouvez toutes les informations sur cet événement sur cette page.
  </p>
</div>

<div class="col-md-4">
  <h2>Informations sur la course</h2>
  <ul class="text-list information" style="border-color:{{color}}">
    <li><i class="fa fa-map-marker"></i> Lieu <p class="lead" style="color:{{color}}; font-weight:bold">{{course.lieu}}</p></li>

    <li><i class="fa fa-tag"></i> Type <p class="lead" style="color:{{color}}; font-weight:bold">{{course.type.nom}}</p></li>

    <li><i class="fa fa-user"></i> Organisé par <p class="lead" style="color:{{color}}; font-weight:bold">{{course.organisateur}}</p></li>

    <li><i class="fa fa-sign-in"></i> Inscription
      {% if course.inscription %}

      {% if is_past(course.modification | date("Y-m-d H:i:s")) %}
      <p class="lead" style="color:{{color}}; font-weight:bold">Les inscriptions sont closes</p>
      {% else %}
      <p class="lead" style="color:{{color}}; font-weight:bold">Sur le site jusqu'au {{strftime(course.modification | date("Y-m-d H:i:s"), "%A %d %B à %H:%M:%S")}}</p>
      {% endif %}

      {% else %}
      <p class="lead" style="color:{{color}}; font-weight:bold">Voir avec l'organisateur</p>
      {% endif %}
    </li>
    {% if course.gps != null %}
    <li><i class="fa fa-location-arrow"></i> Coordonnées GPS <p class="lead"  style="color:{{color}}; font-weight:bold">{{course.gps}}</p></li>
    {% endif %}

    {% if sizeof(course.circuits) > 0 %}
    <li><i class="fa fa-map-signs"></i> Circuits
      <p class="lead"  style="color:{{color}}; font-weight:bold">
        {% for circuit in course.circuits %}
        {{circuit.nom}} {% if circuit.information != null %}- {{circuit.information}} - {{sizeof(circuit.inscrits)}} inscrit(s){% endif %}
        {% endfor %}
      </p>
    </li>
    {% endif %}

  </ul>
</div>

<div class="col-md-1">
</div>

<div class="col-md-7">
  <div class="row">
    <h2>L'annonce de course, les horaires, le site, ...</h2>
    <p class="lead">Tous les fichiers importants liés à cette événement.</p>
    {% if course.site != null %}
    <a href="{{course.site}}" class="btn btn-square-toround btn-bordered-primary"><span class="fa fa-info"></span> Site Internet</a>
    {% endif %}

    {% if annonce_exists(course.id) %}
    <a href="/files/courses/{{course.id}}/annonce.pdf" target="_BLANK" class="btn btn-square-toround btn-bordered-info"><span class="fa fa-flag"></span> Annonce de course</a>
    {% endif %}

    {% for file in get_files(course.id) %}
    {% if is_file(file) %}
    <a href="/files/courses/{{course.id}}/autres/{{basename(file, '')}}" target="_BLANK" class="btn btn-square-toround btn-bordered-warning"><span class="fa fa-leaf"></span> {{basename(file, '.*')}}</a>
    {% endif %}
    {% endfor %}
  </div>

  {% if course.inscription %}
  <div class="row-divider"></div>

  <div class="row">
    <h2>Les inscrits</h2>
    <p class="lead">Ils sont déjà inscrits à cette course.</p>
    {% include 'alerts/alerts.form_validation.html.twig' %}

    {% if form.vars.errors is not empty %}
    <div class="alert alert-dismissible alert-danger">
      L'inscription n'a pas pu être effectuée. Vérifiez les valeurs que vous avez saisies.<br/>
      Peut-être que vous êtes déjà inscrit sur cette course ?
      {{ form_errors(form) }}
    </div>
    {% endif %}

    {% include 'lists/lists.inscrits_course.html.twig' %}

    {% if is_past(course.modification | date("Y-m-d H:i:s")) == false %}
    {% if app.user != null %}
    <button data-toggle="modal"
            data-target="#ModalQuickEntries"
            class="btn btn-square-toround btn-bordered-success">
      <span class="fa fa-user-plus"></span> Inscription rapide
    </button>
    {% endif %}
    <a href="" class="btn btn-square-toround btn-bordered-success"><span class="fa fa-user-plus"></span> S'inscrire</a>
    <a href="/inscription/modification" class="btn btn-square-toround btn-bordered-primary"><span class="fa fa-pencil-square-o"></span> Modifier ses inscriptions</a>
    {% endif %}
  </div>
  {% endif %}

  <div class="row-divider"></div>

  <div class="row">
    <h2>Comment s'y rendre ?</h2>
    <p class="lead">Le plan d'accès vous montre le localisation du point d'accueil de l'événement.</p>

  </div>
</div>

{% if is_past(course.modification | date("Y-m-d H:i:s")) == false %}
{% include 'modals/modal.quick_entries.html.twig' %}
{% endif %}
{% endblock %}
